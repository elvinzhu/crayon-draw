/**
 * crayon-draw v1.0.1
 * (c) 2014-2021 by elvinzhu(https://github.com/elvinzhu/crayon-draw)
 * Released under the MIT License.
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).CrayonDraw=i()}(this,(function(){"use strict";var t=function(){function t(t,i){this.x=t,this.y=i}return t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.distanceFrom=function(t){var i=this.x-t.x,o=this.y-t.y;return Math.sqrt(i*i+o*o)},t.prototype.setFromPoint=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.normalize=function(i){null==i&&(i=1);var o=this.distanceFrom(new t(0,0));return o>0&&(this.x=this.x/o*i,this.y=this.y/o*i),this},t.prototype.multiply=function(i){return new t(this.x*i,this.y*i)},t}();function i(t,i){return i=i||0,Math.random()*((t||1)-i)+i}return function(){function o(){var i=this;this.color="#000000",this.opacity=1,this.width=10,this.inkAmount=1,this._strokeLength=0,this._point=null,this._lastPoint=null,this._size=0,this._sep=4,this._touchStarted=!1,this.touchStart=function(t){i._touchStarted=!0;var o=i.getPoint(t);"eraser"===i.color?(i._ctx.globalCompositeOperation="destination-out",i._ctx.beginPath(),i._ctx.moveTo(o.x,o.y)):(i._ctx.fillStyle=i.color,i._ctx.globalCompositeOperation="source-over",i._ctx.globalAlpha=i.opacity,i._point=o)},this.touchMove=function(o){if(i._touchStarted){var e=i.getPoint(o);"eraser"===i.color?(i._ctx.lineTo(e.x,e.y),i._ctx.stroke()):i.color&&(i._lastPoint=i._point,i._point=e,i._strokeLength=e.subtract(i._lastPoint).distanceFrom(new t(0,0)),i.draw())}},this.touchEnd=function(){i._touchStarted=!1}}return o.prototype.initialize=function(i,o){var e=window.devicePixelRatio||1;if(this.canvas="string"==typeof i?document.getElementById(i):i,o){var n=o.width,s=o.color,h=o.inkAmount,r=o.opacity;"string"==typeof s&&(this.color=s),n>0&&(this.width=n),h>0&&(this.inkAmount=h),r>0&&(this.inkAmount=h)}this._point=new t(0,0),this._size=this.width/2,this.canvas.width=this.canvas.offsetWidth*e,this.canvas.height=this.canvas.offsetHeight*e,this._ctx=this.canvas.getContext("2d"),this._ctx.scale(e,e),this._ctx.lineJoin="round",this._ctx.lineCap="round",this._ctx.lineWidth=2*this.width,this.canvas.addEventListener("touchstart",this.touchStart),this.canvas.addEventListener("touchmove",this.touchMove),window.addEventListener("touchend",this.touchEnd),this.canvas.addEventListener("mousedown",this.touchStart),this.canvas.addEventListener("mousemove",this.touchMove),window.addEventListener("mouseup",this.touchEnd)},o.prototype.setColor=function(t){this.color=t},o.prototype.setOpacity=function(t){this.opacity=t},o.prototype.setWidth=function(t){this.width=t,this._size=t/2},o.prototype.setInkAmount=function(t){this.inkAmount=t},o.prototype.draw=function(){var o,e,n,s,h,r,c,a,u,d,p,v,f,l,y,_,m,x;for(d=this._point.subtract(this._lastPoint),p=Math.ceil(this._size/2),v=Math.floor(d.distanceFrom(new t(0,0))/p)+1,d.normalize(p),f=this._sep*(_=this.inkAmount/this._strokeLength*3,"number"!=typeof(x=.5)&&(x=0),_>(m=1)?m:_<x?x:_),l=Math.ceil(this._size*this._sep),y=this._size/2,this._ctx.beginPath(),o=0;o<l;o++)for(e=0;e<v;e++)n=this._lastPoint.add(d.multiply(e)),s=i(y),h=i(2*Math.PI),a=i(f,f/2),u=i(f,f/2),r=n.x+s*Math.sin(h)-a/2,c=n.y+s*Math.cos(h)-u/2,this._ctx.rect(r,c,a,u);this._ctx.fill()},o.prototype.getPoint=function(i){var o;return o=/^touch/.test(i.type)?i.changedTouches[0]:i,new t(o.pageX-this.canvas.offsetLeft,o.pageY-this.canvas.offsetTop)},o.prototype.destroy=function(){this.canvas.removeEventListener("touchstart",this.touchStart),this.canvas.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd),this.canvas.removeEventListener("mousedown",this.touchStart),this.canvas.removeEventListener("mousemove",this.touchMove),window.removeEventListener("mouseup",this.touchEnd)},o}()}));
